<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalized Learning Content Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4c63d2 0%, #9b59b6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .api-config {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px;
            text-align: left;
        }

        .api-config h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .api-key-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-family: monospace;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
        }

        .upload-section, .output-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #e1e5f2;
            transition: all 0.3s ease;
        }

        .upload-section:hover, .output-section:hover {
            border-color: #4c63d2;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 99, 210, 0.1);
        }

        .section-title {
            font-size: 1.4em;
            color: #4c63d2;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5f2;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4c63d2;
            box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
        }

        .file-upload-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload {
            width: 100%;
            padding: 40px 20px;
            border: 2px dashed #4c63d2;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, transparent 0%, rgba(76, 99, 210, 0.05) 100%);
        }

        .file-upload:hover {
            border-color: #9b59b6;
            background: linear-gradient(45deg, rgba(76, 99, 210, 0.05) 0%, rgba(155, 89, 182, 0.05) 100%);
        }

        .file-upload.dragover {
            border-color: #9b59b6;
            background: linear-gradient(45deg, rgba(76, 99, 210, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
            transform: scale(1.02);
        }

        .file-upload-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            top: 0;
            left: 0;
        }

        .upload-icon {
            font-size: 2em;
            color: #4c63d2;
            margin-bottom: 10px;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #4c63d2 0%, #9b59b6 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 99, 210, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e1e5f2;
            border-top: 4px solid #4c63d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .output-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            min-height: 200px;
            border: 1px solid #e1e5f2;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 500px;
            font-family: inherit;
            line-height: 1.6;
        }

        .sample-interests {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .interest-tag {
            background: linear-gradient(135deg, #4c63d2 0%, #9b59b6 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interest-tag:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(76, 99, 210, 0.3);
        }

        .download-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            margin-top: 15px;
            display: none;
        }

        .download-btn:hover {
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        .file-name {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        .config-toggle {
            cursor: pointer;
            color: #4c63d2;
            text-decoration: underline;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e1e5f2;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4c63d2 0%, #9b59b6 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .api-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
        }

        .api-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .api-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Personalized Learning Generator</h1>
            <p>Transform any educational content into personalized learning experiences using AI</p>
            
            <div class="api-config">
                <h3>🔧 OpenAI Configuration</h3>
                <p><span class="config-toggle" onclick="toggleApiConfig()">Click to configure OpenAI API (required)</span></p>
                <div id="apiConfigDetails" style="display: none; margin-top: 15px;">
                    <input type="password" id="openaiApiKey" class="api-key-input" placeholder="Enter your OpenAI API Key (sk-...)">
                    <select id="aiModel">
                        <option value="gpt-4">GPT-4 (Recommended)</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Faster/Cheaper)</option>
                    </select>
                    <button class="btn" style="margin-top: 10px; text-transform: none;" onclick="testApiConnection()">Test API Connection</button>
                    <div id="apiStatus" class="api-status"></div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="upload-section">
                <h2 class="section-title">📚 Upload & Customize</h2>
                
                <div class="form-group">
                    <label for="interests">Your Interests/Hobbies:</label>
                    <input type="text" id="interests" placeholder="e.g., Liverpool FC, cooking, basketball, music production" />
                    <div class="sample-interests">
                        <span class="interest-tag" onclick="addInterest('Liverpool FC')">⚽ Liverpool FC</span>
                        <span class="interest-tag" onclick="addInterest('cooking')">👨‍🍳 Cooking</span>
                        <span class="interest-tag" onclick="addInterest('basketball')">🏀 Basketball</span>
                        <span class="interest-tag" onclick="addInterest('gaming')">🎮 Gaming</span>
                        <span class="interest-tag" onclick="addInterest('music')">🎵 Music</span>
                        <span class="interest-tag" onclick="addInterest('photography')">📸 Photography</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="learningStyle">Learning Style:</label>
                    <select id="learningStyle">
                        <option value="analogies">Analogies & Examples from my interests</option>
                        <option value="visual">Visual learning with diagrams</option>
                        <option value="practical">Hands-on practical examples</option>
                        <option value="storytelling">Story-based explanations</option>
                        <option value="technical">Technical deep-dive</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Upload Educational Content:</label>
                    <div class="file-upload-wrapper">
                        <div class="file-upload" id="fileUploadArea">
                            <div class="upload-icon">📄</div>
                            <div>Click to upload or drag & drop</div>
                            <div style="font-size: 14px; color: #666; margin-top: 5px;">
                                Supports: .txt, .md, .pdf files
                            </div>
                            <input type="file" class="file-upload-input" id="fileInput" accept=".txt,.md,.pdf" />
                        </div>
                        <div class="file-name" id="fileName"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="textContent">Or paste text content:</label>
                    <textarea id="textContent" placeholder="Paste your educational content here..."></textarea>
                </div>

                <button class="btn" id="generateBtn" onclick="generatePersonalizedContent()">
                    ✨ Generate Personalized Content
                </button>

                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <div id="loadingText">Personalizing your content with AI...</div>
                </div>

                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>
            </div>

            <div class="output-section">
                <h2 class="section-title">🎨 Personalized Output</h2>
                <div class="output-content" id="output">
                    Your personalized content will appear here...
                    
                    <br><br>
                    <strong>How it works:</strong>
                    <br>1. Enter your interests/hobbies
                    <br>2. Choose your learning style
                    <br>3. Upload a file or paste content
                    <br>4. Configure OpenAI API key
                    <br>5. Click generate!
                    
                    <br><br>
                    The AI will add relevant analogies and examples from your interests throughout the content.
                </div>
                <button class="btn download-btn" id="downloadBtn" onclick="downloadContent()">
                    💾 Download Personalized Content
                </button>
            </div>
        </div>
    </div>

    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script>
        let originalContent = '';
        let personalizedContent = '';
        let isApiConfigured = false;

        // Configuration functions
        function toggleApiConfig() {
            const details = document.getElementById('apiConfigDetails');
            details.style.display = details.style.display === 'none' ? 'block' : 'none';
        }

        async function testApiConnection() {
            const apiKey = document.getElementById('openaiApiKey').value.trim();
            const statusDiv = document.getElementById('apiStatus');
            
            if (!apiKey) {
                showApiStatus('Please enter an API key', 'error');
                return;
            }
            
            if (!apiKey.startsWith('sk-')) {
                showApiStatus('Invalid API key format. Should start with "sk-"', 'error');
                return;
            }

            statusDiv.style.display = 'block';
            statusDiv.textContent = 'Testing connection...';
            statusDiv.className = 'api-status';

            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    isApiConfigured = true;
                    showApiStatus('✅ API connection successful!', 'success');
                } else {
                    const error = await response.json();
                    showApiStatus(`❌ API Error: ${error.error?.message || 'Invalid API key'}`, 'error');
                }
            } catch (error) {
                showApiStatus(`❌ Connection failed: ${error.message}`, 'error');
            }
        }

        function showApiStatus(message, type) {
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.style.display = 'block';
            statusDiv.textContent = message;
            statusDiv.className = `api-status ${type}`;
        }

        // File handling functions
        async function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const fileReader = new FileReader();
                fileReader.onload = async function() {
                    try {
                        const typedArray = new Uint8Array(this.result);
                        const pdf = await pdfjsLib.getDocument(typedArray).promise;
                        let fullText = '';
                        
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            fullText += pageText + '\n\n';
                        }
                        
                        resolve(fullText.trim());
                    } catch (error) {
                        reject(error);
                    }
                };
                fileReader.onerror = () => reject(new Error('Failed to read PDF file'));
                fileReader.readAsArrayBuffer(file);
            });
        }

        // Handle file upload
        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('fileName').textContent = `Selected: ${file.name}`;
            
            try {
                let content = '';
                
                if (file.type === 'application/pdf') {
                    document.getElementById('fileName').textContent += ' (Extracting text...)';
                    content = await extractTextFromPDF(file);
                } else {
                    // Text files
                    content = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = e => resolve(e.target.result);
                        reader.onerror = () => reject(new Error('Failed to read file'));
                        reader.readAsText(file);
                    });
                }
                
                originalContent = content;
                document.getElementById('textContent').value = content;
                document.getElementById('fileName').textContent = `✅ Loaded: ${file.name} (${content.length} characters)`;
                
            } catch (error) {
                showError(`Failed to process file: ${error.message}`);
                document.getElementById('fileName').textContent = `❌ Failed to load: ${file.name}`;
            }
        });

        // Drag and drop functionality
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, () => {
                fileUploadArea.classList.add('dragover');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, () => {
                fileUploadArea.classList.remove('dragover');
            }, false);
        });

        fileUploadArea.addEventListener('drop', function(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                fileInput.files = files;
                fileInput.dispatchEvent(new Event('change'));
            }
        }, false);

        // Add interest tags
        function addInterest(interest) {
            const interestsInput = document.getElementById('interests');
            const currentInterests = interestsInput.value;
            if (!currentInterests.includes(interest)) {
                interestsInput.value = currentInterests ? currentInterests + ', ' + interest : interest;
            }
        }

        // Generate personalized content with OpenAI
        async function generatePersonalizedContent() {
            const interests = document.getElementById('interests').value.trim();
            const learningStyle = document.getElementById('learningStyle').value;
            const textContent = document.getElementById('textContent').value.trim();
            const apiKey = document.getElementById('openaiApiKey').value.trim();

            // Validation
            if (!interests) {
                showError('Please enter your interests or hobbies!');
                return;
            }

            if (!textContent) {
                showError('Please upload a file or paste some content!');
                return;
            }

            if (!apiKey) {
                showError('Please configure your OpenAI API key first!');
                return;
            }

            if (textContent.length > 15000) {
                showError('Content is too long. Please use content under 15,000 characters for better results.');
                return;
            }

            // Show loading
            showLoading();
            hideMessages();

            try {
                personalizedContent = await personalizeWithOpenAI(textContent, interests, learningStyle, apiKey);
                document.getElementById('output').textContent = personalizedContent;
                document.getElementById('downloadBtn').style.display = 'block';
                showSuccess('Content personalized successfully! 🎉');
                
            } catch (error) {
                showError('Error generating content: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // OpenAI API integration
        async function personalizeWithOpenAI(content, interests, learningStyle, apiKey) {
            const model = document.getElementById('aiModel').value;

            const prompt = `You are an expert educational content personalizer. Your task is to transform the given educational content by adding relevant analogies, examples, and explanations that connect to the learner's specific interests.

INSTRUCTIONS:
1. Keep ALL original technical content, concepts, and information intact
2. Add personalized analogies and examples from these interests: ${interests}
3. Use ${learningStyle} learning approach
4. Insert relevant connections throughout the content, not just at the end
5. Make the content more engaging while preserving educational value
6. Don't remove any important information - only enhance and personalize

For each major concept or section, try to include a relevant analogy or example from the learner's interests: ${interests}

Learning style to use: ${learningStyle}

Original content to personalize:

${content}

Please return the enhanced, personalized version:`;

            updateProgress(20);

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ 
                        role: 'user', 
                        content: prompt 
                    }],
                    max_tokens: 4000,
                    temperature: 0.7
                })
            });

            updateProgress(60);

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || `API request failed (${response.status})`);
            }

            const data = await response.json();
            updateProgress(90);

            if (!data.choices || !data.choices[0]) {
                throw new Error('No response generated from API');
            }

            updateProgress(100);

            // Add a personalized header
            const personalizedHeader = `# 🎯 Your Personalized Learning Content

*This content has been customized for someone interested in: ${interests}*
*Learning style: ${learningStyle.replace('_', ' ')}*
*Generated with AI on ${new Date().toLocaleDateString()}*

---

`;

            return personalizedHeader + data.choices[0].message.content;
        }

        // UI helper functions
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('progressBar').style.display = 'block';
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('loadingText').textContent = 'Personalizing your content with AI...';
            updateProgress(0);
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('generateBtn').disabled = false;
        }

        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = percent + '%';
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        // Download functionality
        function downloadContent() {
            if (!personalizedContent) {
                showError('No content to download');
                return;
            }

            const blob = new Blob([personalizedContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `personalized_learning_${new Date().toISOString().split('T')[0]}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize PDF.js
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
</body>
</html>