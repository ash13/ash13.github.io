<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalized AI Learning Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 40px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .api-setup {
            margin-bottom: 30px;
            padding: 25px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            border-left: 5px solid #fdcb6e;
        }

        .api-setup h3 {
            color: #856404;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-setup input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ffeaa7;
            border-radius: 8px;
            font-family: monospace;
        }

        .api-setup .help-text {
            margin-top: 10px;
            font-size: 14px;
            color: #856404;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            transition: width 0.3s ease;
            width: 0%;
        }

        .step {
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #4facfe;
        }

        .step h2 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-number {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input[type="file"], input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input[type="file"]:focus, input[type="text"]:focus, textarea:focus, select:focus {
            border-color: #4facfe;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            min-height: 50px;
        }

        .tag {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag .remove {
            cursor: pointer;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .output-section {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #4facfe;
        }

        .slide-preview {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .slide-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4facfe;
        }

        .slide-content {
            line-height: 1.6;
            color: #666;
            white-space: pre-wrap;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.processing {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .file-info {
            background: #e9ecef;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #6c757d;
        }

        .extracted-content {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
            white-space: pre-wrap;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎓 Personalized AI Learning Platform</h1>
            <p>Transform your lecture slides with Claude AI personalization</p>
        </div>

        <div class="main-content">
            <!-- API Setup -->
            <div class="api-setup">
                <h3>🔑 Claude API Configuration</h3>
                <input type="password" id="apiKey" placeholder="Enter your Claude API key (sk-ant-...)">
                <div class="help-text">
                    Get your API key from <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a>. 
                    Your key is stored locally and never sent to our servers.
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Step 1: Upload Slides -->
            <div class="step">
                <h2><span class="step-number">1</span>Upload Lecture Slides</h2>
                <div class="form-group">
                    <label for="slideUpload">Select your PowerPoint or PDF slides:</label>
                    <input type="file" id="slideUpload" accept=".pptx,.pdf,.ppt,.txt" />
                    <div class="file-info" id="fileInfo" style="display: none;"></div>
                    <div class="extracted-content" id="extractedContent" style="display: none;"></div>
                </div>
            </div>

            <!-- Step 2: Student Background -->
            <div class="step">
                <h2><span class="step-number">2</span>Student Background</h2>
                <div class="form-group">
                    <label for="background">Academic/Professional Background:</label>
                    <select id="background">
                        <option value="">Select background...</option>
                        <option value="journalism">Journalism</option>
                        <option value="geography">Geography</option>
                        <option value="business">Business</option>
                        <option value="psychology">Psychology</option>
                        <option value="engineering">Engineering</option>
                        <option value="medicine">Medicine</option>
                        <option value="education">Education</option>
                        <option value="arts">Arts & Humanities</option>
                        <option value="science">Natural Sciences</option>
                        <option value="law">Law</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="experience">Experience Level:</label>
                    <select id="experience">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
            </div>

            <!-- Step 3: Interests -->
            <div class="step">
                <h2><span class="step-number">3</span>Personal Interests</h2>
                <div class="form-group">
                    <label for="interestsInput">Add interests (press Enter after each):</label>
                    <input type="text" id="interestsInput" placeholder="e.g., football, baking, Liverpool FC..." />
                    <div class="tags-input" id="interestsTags"></div>
                </div>
            </div>

            <!-- Step 4: Learning Preferences -->
            <div class="step">
                <h2><span class="step-number">4</span>Learning Preferences</h2>
                <div class="form-group">
                    <label for="learningStyle">Preferred Learning Style:</label>
                    <select id="learningStyle">
                        <option value="visual">Visual (diagrams, charts, images)</option>
                        <option value="practical">Practical (real-world examples)</option>
                        <option value="analytical">Analytical (detailed explanations)</option>
                        <option value="storytelling">Storytelling (narratives, case studies)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="complexity">Content Complexity:</label>
                    <select id="complexity">
                        <option value="simplified">Simplified explanations</option>
                        <option value="balanced">Balanced approach</option>
                        <option value="detailed">Detailed technical content</option>
                    </select>
                </div>
            </div>

            <!-- Generate Button -->
            <div class="step">
                <button class="btn" id="generateBtn" onclick="generatePersonalizedContent()">
                    🚀 Generate Personalized Content
                </button>
            </div>

            <!-- Output Section -->
            <div class="output-section" id="outputSection">
                <h2>📋 Your Personalized Slides</h2>
                <div id="statusMessage"></div>
                <div id="slidePreview"></div>
                <div class="export-buttons">
                    <button class="btn" onclick="exportToText()">📄 Export as Text</button>
                    <button class="btn" onclick="copyToClipboard()">📋 Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let interests = [];
        let uploadedFile = null;
        let extractedText = '';
        let personalizedContent = null;

        // PDF.js worker setup
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // File upload handler
        document.getElementById('slideUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                uploadedFile = file;
                const fileInfo = document.getElementById('fileInfo');
                fileInfo.innerHTML = `📎 ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                fileInfo.style.display = 'block';
                
                // Extract text from file
                showStatus('📄 Extracting content from your file...', 'processing');
                try {
                    extractedText = await extractTextFromFile(file);
                    const contentDiv = document.getElementById('extractedContent');
                    contentDiv.textContent = extractedText.substring(0, 500) + (extractedText.length > 500 ? '...\n\n[Content truncated for preview]' : '');
                    contentDiv.style.display = 'block';
                    showStatus('✅ Content extracted successfully!', 'success');
                } catch (error) {
                    showStatus('❌ Error extracting content: ' + error.message, 'error');
                }
                updateProgress();
            }
        });

        // Extract text from different file types
        async function extractTextFromFile(file) {
            const fileType = file.type || file.name.split('.').pop().toLowerCase();
            
            if (fileType.includes('pdf') || file.name.endsWith('.pdf')) {
                return await extractTextFromPDF(file);
            } else if (fileType.includes('powerpoint') || file.name.endsWith('.pptx') || file.name.endsWith('.ppt')) {
                return await extractTextFromPowerPoint(file);
            } else if (fileType.includes('text') || file.name.endsWith('.txt')) {
                return await file.text();
            } else {
                throw new Error('Unsupported file type. Please use PDF, PowerPoint, or text files.');
            }
        }

        // Extract text from PDF
        async function extractTextFromPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let text = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                text += `\n\n--- Slide ${i} ---\n${pageText}`;
            }
            
            return text;
        }

        // Extract text from PowerPoint (simplified - in production you'd use a proper PPTX parser)
        async function extractTextFromPowerPoint(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const zip = await JSZip.loadAsync(arrayBuffer);
                let text = '';
                let slideCount = 0;

                // Try to extract from slide files
                for (const [filename, zipEntry] of Object.entries(zip.files)) {
                    if (filename.startsWith('ppt/slides/slide') && filename.endsWith('.xml')) {
                        slideCount++;
                        const content = await zipEntry.async('string');
                        // Simple regex to extract text content (this is basic - a full parser would be better)
                        const textMatches = content.match(/<a:t[^>]*>([^<]*)<\/a:t>/g) || [];
                        const slideText = textMatches.map(match => match.replace(/<[^>]*>/g, '')).join(' ');
                        text += `\n\n--- Slide ${slideCount} ---\n${slideText}`;
                    }
                }

                if (text.trim() === '') {
                    throw new Error('No text content found in PowerPoint file');
                }

                return text;
            } catch (error) {
                throw new Error('Could not parse PowerPoint file. Please try converting to PDF first.');
            }
        }

        // Interests tag system
        document.getElementById('interestsInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                addInterest(this.value.trim());
                this.value = '';
            }
        });

        function addInterest(interest) {
            if (!interests.includes(interest)) {
                interests.push(interest);
                renderInterests();
                updateProgress();
            }
        }

        function removeInterest(interest) {
            interests = interests.filter(i => i !== interest);
            renderInterests();
            updateProgress();
        }

        function renderInterests() {
            const container = document.getElementById('interestsTags');
            container.innerHTML = interests.map(interest => 
                `<div class="tag">${interest} <span class="remove" onclick="removeInterest('${interest}')">×</span></div>`
            ).join('');
        }

        // Progress tracking
        function updateProgress() {
            let progress = 0;
            if (uploadedFile && extractedText) progress += 25;
            if (document.getElementById('background').value) progress += 25;
            if (interests.length > 0) progress += 25;
            if (document.getElementById('learningStyle').value) progress += 25;
            
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Event listeners for form updates
        ['background', 'experience', 'learningStyle', 'complexity'].forEach(id => {
            document.getElementById(id).addEventListener('change', updateProgress);
        });

        // Generate personalized content with Claude API
        async function generatePersonalizedContent() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const background = document.getElementById('background').value;
            const experience = document.getElementById('experience').value;
            const learningStyle = document.getElementById('learningStyle').value;
            const complexity = document.getElementById('complexity').value;

            // Validation
            if (!apiKey) {
                showStatus('Please enter your Claude API key.', 'error');
                return;
            }

            if (!uploadedFile || !extractedText) {
                showStatus('Please upload and extract content from your slides first.', 'error');
                return;
            }

            if (!background) {
                showStatus('Please select your background.', 'error');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<div class="loading-spinner"></div>Generating with Claude AI...';

            try {
                showStatus('🤖 Claude is personalizing your content...', 'processing');
                
                const personalizedSlides = await callClaudeAPI(apiKey, {
                    originalContent: extractedText,
                    background,
                    experience,
                    learningStyle,
                    complexity,
                    interests
                });

                personalizedContent = personalizedSlides;
                displayPersonalizedContent();
                showStatus('✅ Your personalized slides are ready!', 'success');
                document.getElementById('outputSection').style.display = 'block';

            } catch (error) {
                showStatus('❌ Error: ' + error.message, 'error');
                console.error('Claude API Error:', error);
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '🚀 Generate Personalized Content';
            }
        }

        // Call Claude API
        async function callClaudeAPI(apiKey, userProfile) {
            const prompt = `You are an expert educational content personalizer. I have lecture slides content that needs to be personalized for a specific student.

Student Profile:
- Background: ${userProfile.background}
- Experience Level: ${userProfile.experience}
- Learning Style: ${userProfile.learningStyle}
- Content Complexity Preference: ${userProfile.complexity}
- Personal Interests: ${userProfile.interests.join(', ')}

Original Lecture Content:
${userProfile.originalContent}

Please personalize this content by:
1. Analyzing the original slides and identifying key topics
2. Rewriting each slide's content to incorporate relevant examples from the student's background and interests
3. Adjusting the complexity and explanation style based on their preferences
4. Making concepts relatable through their personal interests
5. Ensuring the core learning objectives remain intact

Please format your response as a JSON array where each slide is an object with 'title' and 'content' fields. Make the content engaging and personalized while maintaining educational value.

Example format:
[
  {
    "title": "Introduction to [Topic]",
    "content": "Personalized explanation that relates to the student's background and interests..."
  }
]`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-sonnet-20240229',
                    max_tokens: 4000,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || `API request failed: ${response.status}`);
            }

            const data = await response.json();
            const claudeResponse = data.content[0].text;

            // Try to parse JSON response
            try {
                const jsonMatch = claudeResponse.match(/\[[\s\S]*\]/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    // Fallback: create slides from text response
                    return [{
                        title: "Personalized Content",
                        content: claudeResponse
                    }];
                }
            } catch (parseError) {
                // Fallback: treat entire response as content
                return [{
                    title: "Personalized Learning Content",
                    content: claudeResponse
                }];
            }
        }

        function displayPersonalizedContent() {
            const preview = document.getElementById('slidePreview');
            preview.innerHTML = personalizedContent.map((slide, index) => `
                <div class="slide-preview">
                    <div class="slide-title">Slide ${index + 1}: ${slide.title}</div>
                    <div class="slide-content">${slide.content}</div>
                </div>
            `).join('');
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function exportToText() {
            if (!personalizedContent) return;
            
            const content = personalizedContent.map((slide, index) => 
                `Slide ${index + 1}: ${slide.title}\n\n${slide.content}\n\n${'='.repeat(50)}\n\n`
            ).join('');
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'personalized-slides.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        async function copyToClipboard() {
            if (!personalizedContent) return;
            
            const content = personalizedContent.map((slide, index) => 
                `Slide ${index + 1}: ${slide.title}\n\n${slide.content}\n\n`
            ).join('---\n\n');
            
            try {
                await navigator.clipboard.writeText(content);
                showStatus('✅ Content copied to clipboard!', 'success');
            } catch (err) {
                showStatus('❌ Failed to copy to clipboard', 'error');
            }
        }

        // Load saved API key
        document.addEventListener('DOMContentLoaded', function() {
            const savedApiKey = localStorage.getItem('claudeApiKey');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
            }
        });

        // Save API key when entered
        document.getElementById('apiKey').addEventListener('input', function() {
            localStorage.setItem('claudeApiKey', this.value);
        });
    </script>
</body>
</html>